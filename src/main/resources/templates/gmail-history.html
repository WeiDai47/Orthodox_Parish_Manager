<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Email History - PRM</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/theme.css">
    <script src="/js/theme-toggle.js"></script>
    <style>
        body { background-color: var(--bg-primary); color: var(--text-primary); font-family: 'Inter', sans-serif; }
        .navbar { background-color: var(--bg-secondary); }
        .card { background-color: var(--bg-secondary); border: 1px solid var(--border-secondary); }
        .card-header { background-color: var(--bg-tertiary); color: var(--accent-gold); font-weight: 600; }
        .text-gold { color: var(--accent-gold); }
        .table { color: var(--text-primary); }
        .table-hover tbody tr:hover { background-color: var(--bg-tertiary); }
        .nav-link { color: var(--accent-gold) !important; font-weight: bold; }
        .nav-link:hover { color: var(--text-primary) !important; }
        .nav-link.active { color: var(--text-primary) !important; }
        .btn-outline-warning {
            color: var(--accent-gold);
            border-color: var(--accent-gold);
        }
        .btn-outline-warning:hover {
            background-color: var(--accent-gold);
            color: #000;
        }
        .btn-logout {
            background-color: #dc3545;
            border: 2px solid #dc3545;
            color: white;
            font-weight: bold;
            padding: 0.4rem 1rem;
            font-size: 0.9rem;
            margin-left: 1rem;
        }
        .btn-logout:hover {
            background-color: #c82333;
            border-color: #c82333;
            color: white;
        }
    </style>
</head>
<body class="py-3">

<nav class="navbar navbar-expand-lg mb-4">
    <div class="container">
        <a class="navbar-brand text-gold fw-bold" href="/dashboard">PARISH PRM</a>
        <div class="navbar-nav">
            <a class="nav-link" href="/dashboard">Dashboard</a>
            <a class="nav-link" href="/parishioners">Directory (All Souls)</a>
            <a class="nav-link" href="/parishioners/add">Add Member</a>
            <a class="nav-link" href="/links">
                <i class="bi bi-link-45deg"></i> Submission Links
            </a>
            <a class="nav-link" href="/submissions/review">
                <i class="bi bi-inbox"></i> Review Submissions
            </a>
            <a class="nav-link" href="/gmail">
                <i class="bi bi-envelope"></i> Email
            </a>
            <a class="nav-link" href="/settings">
                <i class="bi bi-gear"></i> Settings
            </a>
            <form action="/logout" method="POST" style="display: inline;">
                <input type="hidden" name="_csrf" th:value="${_csrf.token}" />
                <button type="submit" class="btn btn-logout">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </form>
            <button id="themeToggle" class="theme-toggle" title="Toggle theme">
                <i class="bi bi-sun-fill sun-icon"></i>
                <i class="bi bi-moon-stars-fill moon-icon"></i>
            </button>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-clock-history"></i> Sent Email History
                </div>
                <div class="card-body">
                    <a href="/gmail" class="btn btn-outline-warning mb-3">
                        <i class="bi bi-arrow-left"></i> Back to Compose
                    </a>

                    <div th:if="${emailHistory != null && !emailHistory.isEmpty()}" class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Sent At</th>
                                    <th>Subject</th>
                                    <th>Recipients</th>
                                    <th>Mode</th>
                                    <th>Sent By</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="email : ${emailHistory}">
                                    <td th:text="${#temporals.format(email.sentAt, 'MMM dd, yyyy h:mm a')}"></td>
                                    <td th:text="${email.subject}"></td>
                                    <td th:text="${email.recipientCount} + ' recipient(s)'"></td>
                                    <td>
                                        <span th:if="${email.sendMode == 'GROUP_BCC'}" class="badge bg-info">Group (BCC)</span>
                                        <span th:if="${email.sendMode == 'INDIVIDUAL'}" class="badge bg-primary">Individual</span>
                                    </td>
                                    <td th:text="${email.sentBy}"></td>
                                    <td>
                                        <span th:if="${email.success}" class="badge bg-success">
                                            <i class="bi bi-check-circle"></i> Success
                                        </span>
                                        <span th:if="${!email.success}" class="badge bg-danger"
                                              th:title="${email.errorMessage}">
                                            <i class="bi bi-exclamation-circle"></i> Failed
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div th:if="${emailHistory == null || emailHistory.isEmpty()}" class="alert alert-info">
                        <i class="bi bi-info-circle"></i> No emails sent yet. <a href="/gmail">Compose an email</a> to get started.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
