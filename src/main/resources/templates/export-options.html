<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Export & Reports</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet">

    <style>
        body { background-color: #0f0f0f; color: #e0e0e0; padding-top: 50px; }
        .card { background-color: #1a1a1a; border: 1px solid #d4af37; border-radius: 15px; }
        .text-gold { color: #d4af37; }
        .form-label { color: #aaa; font-size: 0.8rem; text-transform: uppercase; }
        .form-control, .form-select, .ts-control { background-color: #252525 !important; border: 1px solid #444 !important; color: white !important; }
        .btn-gold { background-color: #d4af37; color: black; font-weight: bold; }
        .btn-gold:hover { background-color: #b8962e; color: black; }

        /* Ensures the dropdown list matches the dark theme */
        .ts-dropdown { background: #252525 !important; color: white !important; border-color: #444 !important; }
        .ts-dropdown .active { background: #d4af37 !important; color: black !important; }
        .ts-dropdown .option { color: white; }
    </style>
</head>
<body>
<div class="container" style="max-width: 900px;">
    <h2 class="text-gold mb-4 text-center">Parish Report Generator</h2>

    <form th:action="@{/export/generate}" method="post" class="card p-4 shadow-lg">
        <div class="row g-4">

            <div class="col-md-6">
                <label class="form-label">Step 1: Select Format</label>
                <select name="format" id="formatSelect" class="form-select border-warning">
                    <option value="excel">Microsoft Excel (.xlsx)</option>
                    <option value="word">Microsoft Word (.docx)</option>
                </select>
            </div>

            <div class="col-md-6">
                <label class="form-label">Step 2: Filter by Status</label>
                <select name="status" id="statusSelect" class="form-select">
                    <option value="">All Parishioners</option>
                    <option th:each="s : ${T(com.example.orthodox_prm.Enum.MembershipStatus).values()}"
                            th:value="${s}" th:text="${s}"></option>
                </select>
                <small class="text-muted">Select 'DEPARTED' for Memorial (Panikhida) lists.</small>
            </div>

            <div class="col-md-6">
                <label class="form-label">Filter by Name Day Month</label>
                <select name="nameDayMonth" class="form-select">
                    <option value="">Any Month</option>
                    <option value="1">January</option><option value="2">February</option>
                    <option value="3">March</option><option value="4">April</option>
                    <option value="5">May</option><option value="6">June</option>
                    <option value="7">July</option><option value="8">August</option>
                    <option value="9">September</option><option value="10">October</option>
                    <option value="11">November</option><option value="12">December</option>
                </select>
            </div>

            <div class="col-md-6">
                <label class="form-label">Filter by Godparent / Sponsor</label>
                <select name="sponsorId" id="sponsorSelect" class="form-select">
                    <option value="">Search for a Sponsor...</option>
                    <option th:each="p : ${parishioners}" th:value="${p.id}"
                            th:text="${p.firstName + ' ' + p.lastName + (p.baptismalName != null ? ' (' + p.baptismalName + ')' : '')}"></option>
                </select>
            </div>

            <div class="col-12 mt-2">
                <div class="form-check form-switch mb-2">
                    <input class="form-check-input" type="checkbox" name="missingBaptismDate" id="sacramentalCheck">
                    <label class="form-check-label text-warning" for="sacramentalCheck">
                        <strong>Sacramental Eligibility:</strong> Only show Inquirers/Catechumens missing a Baptism Date
                    </label>
                </div>
            </div>
        </div>

        <div class="d-flex gap-3 justify-content-center mt-5">
            <a href="/parishioners" class="btn btn-outline-light px-4">Back to List</a>

            <button type="submit" class="btn btn-gold px-5">
                Generate Custom Report
            </button>

            <button type="submit"
                    onclick="document.getElementById('statusSelect').value='DEPARTED'; document.getElementById('formatSelect').value='word';"
                    class="btn btn-outline-danger px-5">
                Generate Departed List (Word)
            </button>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
<script>
    // Initialize searchable dropdown for sponsors
    new TomSelect("#sponsorSelect", {
        create: false,
        sortField: {
            field: "text",
            direction: "asc"
        },
        placeholder: "Type to search sponsors..."
    });
</script>
</body>
</html>